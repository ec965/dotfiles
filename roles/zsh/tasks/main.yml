- name: Install zsh
  apt: 
    name: zsh
    state: present
  become: 'yes'
  # zsh is preinstalled on MacOS
  when: ansible_facts['os_family'] == "Debian"

- name: Make ZDOTDIR
  file: 
    path: "{{ zdotdir }}"
    state: directory
    mode: '0755'

- name: Link home zshenv
  file:
    src: "{{ ansible_env.PWD }}/roles/zsh/files/home.zshenv"
    path: ~/.zshenv
    state: link

- name: Link zdotdir zshenv
  file:
    src: "{{ ansible_env.PWD }}/roles/zsh/files/dot.zshenv"
    path: "{{ zdotdir }}/.zshenv"
    state: link

- name: Link zshrc
  file:
    src: "{{ ansible_env.PWD }}/roles/zsh/files/dot.zshrc"
    path: "{{ zdotdir }}/.zshrc"
    state: link

- name: Check for Oh my Zsh
  stat: "path={{ oh_my_zsh_path }}"
  register: oh_my_zsh

- name: Install Oh my Zsh
  git:
    repo: https://github.com/ohmyzsh/ohmyzsh.git
    dest: "{{ oh_my_zsh_path }}"
    depth: 1
  when: not oh_my_zsh.stat.exists

- name: Check for Powerlevel10k
  stat: "path={{ oh_my_zsh_path }}/custom/themes/powerlevel10k"
  register: powerlevel10k

- name: Install Powerlevel10k
  git:
    repo: https://github.com/romkatv/powerlevel10k.git
    depth: 1
    dest: "{{ oh_my_zsh_path }}/custom/themes/powerlevel10k"
  when: not powerlevel10k.stat.exists

- name: Check for zsh autosuggestions
  stat: "path={{ oh_my_zsh_path }}/custom/plugins/zsh-autosuggestions"
  register: zsh_autosuggestions

- name: Install zsh autosuggestions
  git:
    repo: https://github.com/zsh-users/zsh-autosuggestions
    dest: "{{ oh_my_zsh_path }}/custom/plugins/zsh-autosuggestions"
  when: not zsh_autosuggestions.stat.exists

- name: Check for zsh syntax highlighting
  stat: "path={{ oh_my_zsh_path }}/custom/plugins/zsh-syntax-highlighting"
  register: zsh_syntax_highlighting

- name: Install zsh syntax highlighting
  git:
    repo: https://github.com/zsh-users/zsh-syntax-highlighting.git
    dest: "{{ oh_my_zsh_path }}/custom/plugins/zsh-syntax-highlighting"
  when: not zsh_syntax_highlighting.stat.exists
